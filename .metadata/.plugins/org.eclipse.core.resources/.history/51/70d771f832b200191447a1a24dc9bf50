/**
  ******************************************************************************
  * @file    BSP.cpp
  * @author  John Arild Lolland
  ******************************************************************************
*/

#include "BSP.h"

int BSP_STM32CAN::initilize (){
    BSP_STM32CAN::MCUspeed_48MHz();
	BSP_STM32CAN::setup_GPIO ();
	BSP_STM32CAN::setup_CAN ();
	BSP_STM32CAN::setup_SPI ();
    return 0;
}

int BSP_STM32CAN::MCUspeed_48MHz (){
	FLASH->ACR |= FLASH_ACR_LATENCY; // One wait-state for 48MHz operation
	FLASH->ACR |= FLASH_ACR_PRFTBE; // Prefetch buffer enable
	RCC->AHBENR |= RCC_AHBENR_GPIOFEN; // External crystal is on Port F
	RCC->CFGR |= RCC_CFGR_PLLMULL6; // Set PLL to x6 for 48MHz

	RCC->CR |= RCC_CR_HSEON; // Turn in external clock input
	while(!((RCC->CR & RCC_CR_HSERDY)== RCC_CR_HSERDY)){;}
	RCC->CR |= RCC_CR_PLLON;
	while(!((RCC->CR & RCC_CR_PLLRDY)== RCC_CR_PLLRDY)){;}


    return 0;
}

int BSP_STM32CAN::setup_GPIO (){
    return 0;
}

int BSP_STM32CAN::setup_CAN (){
    return 0;
}

int BSP_STM32CAN::setup_SPI (){
    return 0;
}

int BSP_STM32CAN::configLED(){
	RCC->AHBENR |= RCC_AHBENR_GPIOAEN;
	GPIOA->MODER |= GPIO_MODER_MODER3_0;
	return 0;
}
